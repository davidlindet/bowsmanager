<?php
    /** @var $collection \Collection\Model\Collection */
use \Application\Enum\SectionEnum;
?>
<h1>
    <img src="/img/collection/header.png" width='80' /> <?php echo $this->translate("Collection"); ?>
</h1>
<a class="back" href="<?php
switch($section) {
    case SectionEnum::CLIENT_DETAILS:
        $backUrl = $this->url('client-details', array('id' => $collection->getOwnerId()));
        break;
    case SectionEnum::INDEX_INDEX:
        $backUrl = $this->url('home');
        break;
    default:
        $backUrl = $this->url('collection');
}
echo $backUrl;
?>"><img src="/img/content/back.png"><?php echo $this->translate("Back") ?></a>

<div class="options">
    <a class="edit" href="<?php echo $this->url('collection-edit', array('id' => $collection->getId(), 'section' => $section));?>">
        <img src="/img/collection/edit.png"><?php echo $this->translate("Edit") ?></a>
    <div class="collection delete" data-id="<?php echo $collection->getId() ?>" data-clientid="<?php echo $collection->getOwnerId() ?>" data-section="<?php echo $section ?>" >
        <img src="/img/collection/del.png"><?php echo $this->translate("Delete") ?>
    </div>
</div>
<div class="error-message collection"></div>
<?php
    $ownerName = $collection->getOwnerName();
    $receptionTime = $collection->getReceptionTime();
    $countBows = $collection->countBows();
    $returnTime = $collection->getReturnTime();
    $packageNumber = $collection->getPackageNumber();
    $billReference = $collection->getBillReference();
    $billAmount = $collection->getBillAmount();
    $paidStatus = $collection->isPaid();
?>
<div class="details">
    <dl>
        <?php if(!empty($ownerName)) { ?>
            <dt><?php echo $this->translate("Client") ?></dt>
            <dd>
                <a href="<?php echo $this->url('client-details', array('id' => $collection->getOwnerId())) ?>">
                    <?php echo $ownerName ?>
                </a>
            </dd>
        <?php
        }
        ?>
        <?php if(!empty($receptionTime)){ ?>
            <dt><?php echo $this->translate("Reception Date") ?></dt>
            <dd><?php echo $receptionTime ?></dd>
        <?php
        }
        ?>
        <?php if(!empty($countBows)){ ?>
            <dt><?php echo $this->translate("Bows") ?></dt>
            <dd><?php echo $countBows ?></dd>
        <?php
        }
        ?>
    </dl>
    <dl>
        <?php if(!empty($returnTime)){ ?>
            <dt><?php echo $this->translate("Return Date") ?></dt>
            <dd><?php echo $returnTime ?></dd>
        <?php
        }
        ?>
        <?php if(!empty($packageNumber)){ ?>
            <dt><?php echo $this->translate("Package Number") ?></dt>
            <dd><?php echo $packageNumber ?></dd>
        <?php
        }
        ?>
    </dl>
    <dl>
        <?php if(!empty($billReference)){ ?>
            <dt><?php echo $this->translate("Bill Reference") ?></dt>
            <dd>
            <?php
                if($collection->hasAttachments()) {
                    $files = $collection->getAttachments();

                    if(count($files) == 1){
            ?>
                    <a target="_blank"href="/img/attachment/<?php echo array_shift($files); ?>" >
                        <?php echo $billReference ?>
                    </a>
            <?php
                    }
                    else {
            ?>
                    <?php echo $billReference ?><br />
            <?php
                        foreach($files as $attachment) {
            ?>
                    <a target="_blank"href="/img/attachment/<?php echo $attachment; ?>" >
                        <?php echo $this->fileType()->getOriginalName($attachment) ?>
                    </a><br />
            <?php
                        }
                    }
                }
            ?>
            </dd>
        <?php
        }
        ?>
        <?php if(!empty($billAmount)){ ?>
            <dt><?php echo $this->translate("Bill Amount") ?></dt>
            <dd><?php echo $billAmount ?> â‚¬</dd>
        <?php
        }
        ?>
        <?php if(!empty($paidStatus)){ ?>
            <dt><?php echo $this->translate("Is paid?") ?></dt>
            <dd>
                <?php if($paidStatus) { ?>
                    <img width="25" src="/img/content/valid.png">
                <?php } ?>
            </dd>
        <?php
        }
        ?>
    </dl>
</div>

<div class="bow-list">
<?php
    echo $this->partial('bowList', array(
        'bows' => $collection->getBows(),
        'collectionId' => $collection->getId(),
        'section' => $section,
    ));
?>
</div>
<?php
    $this->placeholder('scripts')->append("
        BowsManager.collection.del();
    ");
?>